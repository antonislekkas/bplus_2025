Άσκηση 2 – Προθεσμία 7/12/2025
Σκοπός

Σκοπός της εργασίας αυτής είναι η κατανόηση της εσωτερικής λειτουργίας των Συστημάτων Βάσεων
Δεδομένων, όσον αφορά τη διαχείριση δεδομένων σε επίπεδο μπλοκ (block). Επίσης, μέσω της
εργασίας θα εξεταστεί σε ποιο βαθμό η ύπαρξη ευρετηρίων πάνω στις εγγραφές μπορεί να βελτιώσει
την απόδοση ενός Συστήματος Διαχείρισης Βάσεων Δεδομένων (ΣΔΒΔ). Πιο συγκεκριμένα, στα
πλαίσια της 2ης εργασίας, θα υλοποιήσετε ένα σύνολο συναρτήσεων που διαχειρίζονται αρχεία
δεδομένων, τα οποία έχουν δημιουργηθεί βάσει πρωτευόντων Β+-δέντρων.
Οι συναρτήσεις που καλείστε να υλοποιήσετε αφορούν τη διαχείριση εγγραφών και ευρετηρίων. Η
υλοποίησή τους θα βασιστεί υποχρεωτικά στο επίπεδο διαχείρισης μπλοκ, το οποίο παρέχεται ως
βιβλιοθήκη (BF). Η διαχείριση των αρχείων ενός Β+-δέντρου γίνεται μέσω των συναρτήσεων της
βιβλιοθήκης bplus_file_funcs.h, τις οποίες καλείστε να υλοποιήσετε. Τα αρχεία του Β+-δέντρου θα
αποθηκεύουν εγγραφές, τις οποίες πρέπει να διαχειρίζεστε μέσω των κατάλληλων συναρτήσεων.
Το πρώτο μπλοκ (block) κάθε αρχείου Β+-δέντρου θα πρέπει να περιλαμβάνει μεταδεδομένα σχετικά
με το ίδιο το αρχείο. Η πληροφορία αυτή χρησιμεύει για να αναγνωριστεί αν πρόκειται πράγματι για
αρχείο Β+-δέντρου, καθώς και για να ενημερώσει τον χρήστη σχετικά με χαρακτηριστικά του Β+-
δέντρου, όπως η ρίζα του, το ύψος του κ.λπ.
Για να ελέγξετε την ορθότητα και πληρότητα της υλοποίησης, σας δίνεται ενδεικτικά η συνάρτηση
main, η οποία περιέχεται στο αρχείο examples/bplus_main.c. Η main δημιουργεί δύο B+ δέντρα, ένα
για υπαλλήλους και ένα για φοιτητές, και σε δεύτερο χρόνο αναζητά κάποια εγγραφή στους δύο
αυτούς πίνακες. Θα πρέπει να χρησιμοποιήσετε και να επεκτείνετε τη main για να ελέγξετε την
ορθότητα και πληρότητα του προγράμματός σας για πολλές εισαγωγές.
Βιβλιοθήκη BF
Η ολοκλήρωση της εργασίας θα βασιστεί στη βιβλιοθήκη που διαχειρίζεται τα block, γνωστή ως
επίπεδο block (BF), η οποία έχει παρουσιαστεί στην 1η άσκηση. Αυτή η βιβλιοθήκη λειτουργεί ως
ενδιάμεση μνήμη (buffer) και διαχειριστής μνήμης (buffer manager), διευκολύνοντας την πρόσβαση
στα block του δίσκου και βελτιστοποιώντας τα διαβάσματα και τα γραψίματα στον σκληρό δίσκο.
Βιβλιοθήκη Record
Για την ολοκλήρωση της 2ης άσκησης, σας δίνεται η βιβλιοθήκη record.h, την οποία θα πρέπει να
χρησιμοποιήσετε για να σας βοηθάει στη διαχείριση πινάκων και εγγραφών σε βάσεις δεδομένων.
Σας επιτρέπει να ορίσετε το σχήμα ενός πίνακα, τα γνωρίσματα και τους αντίστοιχους τύπους
δεδομένων, και στη συνέχεια να δημιουργήσετε εγγραφές σύμφωνα με το σχήμα. Παρέχει
συναρτήσεις για την αρχικοποίηση και εμφάνιση σχήματος πίνακα:
• Η schema_init αρχικοποιεί ένα σχήμα πίνακα, ορίζοντας τα γνωρίσματα και το γνώρισμα
κλειδί του ευρετηρίου.
• Η schema_print εκτυπώνει το σχήμα μιας σχέσης, τα γνωρίσματά του, τους τύπους κάθε
γνωρίσματος και το γνώρισμα κλειδί.
• Η record_create δημιουργεί μία εγγραφή σύμφωνα με το σχήμα που παίρνει ως είσοδο και τις
τιμές για κάθε γνώρισμα.
• Η record_print τυπώνει μια εγγραφή με βάση το σχήμα της.
• Η record_get_key επιστρέφει την τιμή κλειδιού μιας εγγραφής το οποίο είναι πάντα τύπου int.
Πιο αναλυτική περιγραφή των συναρτήσεων θα βρείτε στην παρουσίαση της άσκησης και στο αρχείο
record.h.
Συναρτήσεις BP (B+-Tree)
Στη συνέχεια περιγράφονται οι συναρτήσεις που καλείστε να υλοποιήσετε και αφορούν το B+-
δέντρο. Πέραν των συναρτήσεων, θα χρειαστεί να ορίσετε και τις αντίστοιχες δομές, όπως η
BPlusMeta, η οποία κρατάει τα μεταδεδομένα που αφορούν κάθε B+-δέντρο. Επιπλέον των
συναρτήσεων που σας ζητούνται, θα πρέπει να κρίνετε ποιες επιπλέον βοηθητικές συναρτήσεις και
δομές χρειάζεστε. Συνίσταται να δημιουργήσετε επιπλέον συναρτήσεις και δομές για τα μπλοκ
δεδομένων και τα μπλοκ ευρετηρίου.
/\*\*

- @brief Creates a new empty B+ tree file with the given schema.
- @param schema Pointer to the TableSchema describing the table.
- @param fileName Name of the file to create.
- @return 0 on success, -1 on failure.
  */
  int bplus_create_file(const TableSchema *schema, const char \*fileName);
  /\*\*
- @brief Opens a B+ tree file and loads its metadata.
- @param fileName Name of the file to open.
- @param file_desc Pointer to store the file descriptor.
- @param metadata Pointer to store the metadata structure (allocated by
  the function).
- @return 0 on success, -1 on failure.
  */
  int bplus_open_file(const char *fileName, int \*file_desc, BPlusMeta
  **metadata);
  /**
- @brief Closes a B+ tree file and frees its metadata.
- @param file_desc File descriptor of the B+ tree file.
- @param metadata Pointer to the BPlusMeta structure to free.
- @return 0 on success, -1 on failure.
  _/
  int bplus_close_file(int file_desc, BPlusMeta_ metadata);
  /\*\*
- @brief Inserts a record into the B+ tree.
- @param file_desc File descriptor of the B+ tree file.
- @param metadata Pointer to the BPlusMeta structure of the tree.
- @param record Record to insert.
- @return Block ID of inserted record on success, -1 on failure.
  _/
  int bplus_record_insert(int file_desc, BPlusMeta_ metadata, const Record
  \*record);
  /\*\*
- @brief Finds a record in the B+ tree by key.
- @param file_desc File descriptor of the B+ tree file.
- @param metadata Pointer to the BPlusMeta structure of the tree.
- @param key Key value to search for.
- @param out_record Pointer to store the found record (or NULL if not
  found).
- @return 0 if found, -1 if not found.
  */
  int bplus_record_find(int file_desc, const BPlusMeta *metadata, int key,
  Record\*\* out_record);
  Αρχεία που σας δίνονται
  Στα αρχεία που σας δίνονται θα βρείτε φακέλους που περιέχουν την εργασία που θα πρέπει να
  παραδώσετε. Το project έχει την πιο κάτω δομή:
  • build: Περιέχει όλα τα object files που δημιουργούνται κατά τη μεταγλώττιση.
  • include: Περιέχει όλα τα αρχεία κεφαλίδας (.h) που θα έχει το project σας.
  • lib: Περιέχει το αρχείο libbf.so, που είναι η βιβλιοθήκη για να καλείτε το επίπεδο BF μέσω
  της βιβλιοθήκης bf.h.
  • src: Τα αρχεία κώδικα (.c) της εφαρμογής σας.
  • examples: Σε αυτόν τον φάκελο θα βρείτε την συνάρτηση main (bplus_main.c), η οποία
  περιέχει κώδικα που τρέχει τις συναρτήσεις που πρέπει να υλοποιήσετε.
  Επίσης σας δίνετε και ένα αρχείο Makefile για να κάνετε αυτόματα compile των κώδικά σας.
  Πληροφορίες για την Υλοποίηση
  Παραδοχές
  Για την επιτυχή ολοκλήρωση της άσκησης, θα πρέπει να λάβετε υπόψη τις ακόλουθες παραδοχές:
  • Το σχήμα για το B+ δέντρο θα πρέπει να αποθηκεύεται στα μεταδεδομένα του αντίστοιχου
  αρχείου. Θεωρείστε ότι τα μεταδεδομένα, συμπεριλαμβανομένου και του σχήματος, θα
  μπορούν να αποθηκευτούν σε ένα μόνο block.
  • Κάθε εγγραφή, δηλαδή κάθε στιγμιότυπο της δομής Record, έχει σταθερό μέγεθος, το οποίο
  είναι και το μέγιστο δυνατό μέγεθος που μπορεί να έχει ένα Record, ανεξαρτήτως του
  σχήματός του.
  • Το σχήμα κάθε πίνακα έχει συγκεκριμένους περιορισμούς ως προς τον αριθμό των
  γνωρισμάτων, τον τύπο των γνωρισμάτων, το όνομα κάθε γνωρίσματος και το μέγεθος κάθε
  γνωρίσματος για γνωρίσματα τύπου char. Επιπλέον, το κλειδί ενός σχήματος μπορεί να είναι
  μόνο int.
  Τι να προσέξετε
  ● Οι συναρτήσεις που περιέχονται στη βιβλιοθήκη bplus_file_funcs.h δεν θα πρέπει να
  αλλαχθούν. Οι ομάδες που θα αλλάξουν τις συναρτήσεις δεν θα λάβουν βαθμολογία.
  Αντίστοιχα και για την βιβλιοθήκη record και την υλοποίησή της.
  ● Μπορείτε να προσθέσετε εκτελέσιμα στο Makefile, φροντίζοντας όμως να εκτελούνται
  σωστά χωρίς να αλλαχθούν οι bplus_main_compile και η bplus_main_run. Αν δεν συμβεί
  αυτό, η ομάδα σας δεν θα λάβει βαθμολογία.
  ● Θα πρέπει να καλείτε την συνάρτηση BF_UnpinBlock για κάθε BF_Block που δεν
  χρειάζεστε πλέον. Αν δεν τα κάνετε Unpin τότε ο buffer του επιπέδου BF γεμίζει και δεν
  μπορεί να “θυσιάσει” κάποιο Block γιατί όλα θα είναι ενεργά.
  ● Πάντα να καλείτε την συνάρτηση BF_Block_SetDirty για τα BF_Block που αλλάζετε τα
  δεδομένα τους. Αν δεν τα κάνετε dirty τότε δεν γράφονται στον δίσκο.
  Παράδοση εργασίας
  • Ομάδες: Η εργασία αυτή είναι αυστηρά ομαδική (2 ή 3 ατόμων).
  • Γλώσσα υλοποίησης: C.
  • Περιβάλλον υλοποίησης: Linux (gcc 5.4+).
  • Περιβάλλον εξέτασης: Η εργασία θα εξεταστεί στα linux του di.uoa και καλείστε να έχετε
  ελέγξει ότι εκτελείται ορθώς στο συγκεκριμένο περιβάλλον.
  • Τι παραδίδω: Θα ανακοινωθεί.
